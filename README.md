# crm-go

Библиотека для разработки микросервисов ratus crm по управлению моделями в центральной базе данных.
Управление моделями осуществляется через встроенные в структуры методы.

Методы структур реализует архитектуру:
1. Создание, удаление, связывание, редактирование сущностей.
2. Автоматическое построение связывания, удаления и ограничения при удалении зависимых сущностей.
3. !Построение системы прав и ролей (групп прав) в контексте одного аккаунта. Возможность назначать роли как пользователям, так и ключам доступа.
4. Проверка прав в контекста выполнения запроса. Отсутствие анонимных запросов.
5. Валидация входящих данных в контексте пользователя.

# Account
Аккаунт создается в контексте пользователя. Владелец аккаунта добавляется в аккаунт с ролью owner (неизменяема).

Доступ к CRUD функциям связанных моделей через методы:
```golang
// account_id добавляется автоматически
func (Account) CreateEntity(v Entity) error {}

// Удаление по внутреннему индетификатору, обычно это id.
func (Account) DeleteEntity(v Entity) error {}

// Методы Update & Get используют в качестве первичного ключа hash_id или его аналог (token у ApiKey)
func (Account) GetEntity (hash string, v Entity) error {}
func (Account) UpdateEntity (v Entity) error {}

```

Специфичные методы для каждой сущности вызываются уже в контексте медели.

**Микроконтроллеры должны использовать функции в контексте аккаунта** - это защитит от непреднамеренного удаления системный данных. Такие функции автоматически выполняют необходимые проверки и занимаются привязкой данных к аккаунту.


# Role
Изначально в каждом аккаунте 6 системных ролей для gui:
<ul>
  <li><strong>Владелец</strong> (owner) - доступ ко всем данным и функционалу аккаунта.</li>
  <li><strong>Администратор</strong> (admin) - не может менять владельца аккаунта.</li>
  <li><strong>Менеджер</strong> (manager) - не может добавлять пользователей, не может менять платежную информацию.</li>
  <li><strong>Маркетолог</strong> (marketer) - читает все данные, управляет разделом рекламы.</li>
  <li><strong>Автор</strong> (author) - может создавать контент: писать статьи, письма, описания к товарам.</li>
  <li><strong>Наблюдатель</strong> (viewer) - читает отчеты, данные складов, нет доступа к клиентской базе.</li>
</ul>

и 3 системные роли для api: 
<ul>
  <li><strong>Full Access</strong> (owner) - доступ ко всем функциям API</li>
  <li><strong>Site Access</strong> (admin) - Доступ к аккаунту через API, необходимый для интеграции с сайтом</li>
  <li><strong>Read Access</strong> (manager) - Доступ к чтению основной информации об аккаунте.</li>
</ul>

Администратор может создать в аккаунте собственную роль со своей системой прав.

# Permission
Права в основном строятся вокруг CRUD модели (create, read, update, delete).

CodeName образуется следующим образом: Permission{ModelName}{Verbs}. Например: PermissionUserListing, PermissionUserEditing, PermissionUserAppend, PermissionUserDeleting.

Пользователи аккаунта:
<ul>
  <li><strong>Просмотр пользователей</strong> (PermissionUserListing) - доступ к чтению списка пользователей, их правам и данным самих пользователей.</li>
  <li><strong>Редактирование пользователя</strong> (PermissionUserEditing) - возможность редактировать права пользователя</li>
  <li><strong>Добавление пользователей</strong> (PermissionUserAppend) - возможность приглашать пользователей в аккаунт.</li>
  <li><strong>Удаление пользователей</strong> (PermissionUserDeleting) - возможность исключать пользователей из аккаунта.</li>
  
</ul>

// todo дописать тут

# Работа с ошибками
Библиотека обрабатывает ошибки и возвращает максимально полные данные: из БД, описания, внутренние ID элементов и т.д.

**Контроллеры** микросервисов **должны самостоятельно интерпритировать** такие данные и при необходимости осмысленно передавать какие-то данные в GUI.

**Валидация форм**<br>
Для валидации данных форм используйте функций типа (*T) Validate<Verb>() e Error. Такие функции возвращают данные по полям + общее описание ошибки.
